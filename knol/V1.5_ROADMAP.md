# Lotion v1.5 - Development Roadmap

## Core Focus Areas

Based on analysis of the official Notion desktop app, v1.5 will focus on three major features:

### 1. **Offline Mode with SQLite** ğŸ—„ï¸
**Priority:** HIGH
**Status:** Foundation exists (better-sqlite3 already installed)

#### What the Official App Does:
- Uses **better-sqlite3** (v11.8.1) for local database
- Separate `SqliteServer.js` module for database operations
- Built-in **SQLite browser** renderer for debugging
- Caches Notion pages locally for offline access
- Faster page loads with local cache

#### Implementation Plan:
- [ ] Create SQLite database schema for caching pages
- [ ] Implement SqliteServer module (separate from main process)
- [ ] Add data synchronization logic
- [ ] Cache page content, blocks, and metadata
- [ ] Handle offline/online state transitions
- [ ] Add cache invalidation strategy
- [ ] Optional: Build SQLite browser tool for debugging

#### Benefits:
- âœ… Works offline
- âœ… Faster page loads
- âœ… Reduced network usage
- âœ… Better user experience

---

### 2. **Tab Management System** ğŸ“‘
**Priority:** HIGH
**Status:** Requires significant architecture changes

#### What the Official App Does:
- **Multi-tab interface** like a web browser
- **Tab groups/spaces** - Organize tabs into sections
- **Tab pinning** with URL restoration
- **Drag-and-drop** tab reordering
- **Parent-child tab relationships**
- **Tab reparenting** - Move tabs between windows
- **Tab preview images** for placeholders
- **Close confirmation** for unsaved changes
- **Tab state persistence** across app restarts

#### Implementation Plan:

**Phase 1: Basic Tabs**
- [ ] Create tab bar UI component (separate renderer)
- [ ] Implement tab state in Redux
  - Tab ID, title, URL, favicon
  - Active tab per window
  - Tab order
- [ ] Add tab creation/closing logic
- [ ] Keyboard shortcuts (Ctrl+T, Ctrl+W, Ctrl+Tab)
- [ ] Tab switching UI and logic

**Phase 2: Advanced Features**
- [ ] Tab pinning functionality
- [ ] Tab groups/spaces
- [ ] Drag-and-drop reordering (using @atlaskit/pragmatic-drag-and-drop)
- [ ] Parent-child tab relationships
- [ ] Tab context menu (right-click)
- [ ] Close other tabs, close tabs to right/left

**Phase 3: Multi-Window**
- [ ] Tab reparenting between windows
- [ ] Tab placeholder previews
- [ ] Move tab to new window

#### Current Dependencies Needed:
```json
{
  "@atlaskit/pragmatic-drag-and-drop": "1.4.0",
  "@atlaskit/pragmatic-drag-and-drop-hitbox": "1.0.3"
}
```

#### Benefits:
- âœ… Multi-page workflow support
- âœ… Better organization
- âœ… Browser-like experience
- âœ… Productivity boost

---

### 3. **Enhanced Breadcrumbs** ğŸ
**Priority:** MEDIUM-HIGH
**Status:** Easiest to implement

#### What the Official App Does:
- Tracks **navigation hierarchy** per tab
- Stores breadcrumbs in Redux state
- Format: `Home > Workspace > Page > Subpage`
- Updates automatically as you navigate
- Displayed in tab UI (shows current location)

#### Implementation Plan:
- [ ] Add `breadcrumbs` field to tab state in Redux
- [ ] Listen for breadcrumb updates from Notion web app
- [ ] Create IPC channel for breadcrumb data
- [ ] Display breadcrumbs in tab bar UI
- [ ] Style breadcrumbs component
- [ ] Handle breadcrumb truncation for long paths

#### Redux State Addition:
```javascript
// In tabSlice.js
updateTabBreadcrumbs(state, action) {
  state[action.payload.tabId].breadcrumbs = action.payload.breadcrumbs;
}
```

#### Benefits:
- âœ… Know where you are in Notion hierarchy
- âœ… Quick visual reference
- âœ… Better navigation UX
- âœ… Matches official app behavior

---

## Implementation Order

### Sprint 1: Foundation (Weeks 1-2)
1. **Set up Tab Management Architecture**
   - Redux slices for tabs and windows
   - Tab bar renderer component
   - Basic IPC communication

2. **Implement Basic Tabs**
   - Create/close tabs
   - Switch between tabs
   - Tab title and favicon

### Sprint 2: Breadcrumbs (Week 3)
1. **Add Breadcrumb Support**
   - Redux state for breadcrumbs
   - IPC channel for breadcrumb updates
   - Display in tab bar

### Sprint 3: Offline Mode Foundation (Weeks 4-5)
1. **SQLite Integration**
   - Database schema design
   - SqliteServer module
   - Basic caching logic

2. **Offline Detection**
   - Online/offline state management
   - Sync strategy

### Sprint 4: Advanced Tabs (Weeks 6-7)
1. **Tab Pinning**
2. **Tab Groups**
3. **Drag-and-drop reordering**
4. **Context menus**

### Sprint 5: Polish & Testing (Week 8)
1. **Performance optimization**
2. **Bug fixes**
3. **Documentation**
4. **Testing**

---

## Technical Architecture Changes

### New Directory Structure
```
lotion/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ AppController.js (existing)
â”‚   â”‚   â”‚   â”œâ”€â”€ WindowController.js (existing)
â”‚   â”‚   â”‚   â””â”€â”€ TabController.js (NEW)
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”‚   â”œâ”€â”€ slices/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ appSlice.js (existing)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ windowsSlice.js (existing)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tabsSlice.js (NEW)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ tabSpacesSlice.js (NEW)
â”‚   â”‚   â”‚   â””â”€â”€ store.js (existing)
â”‚   â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”‚   â”œâ”€â”€ SqliteServer.js (NEW)
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.js (NEW)
â”‚   â”‚   â”‚   â””â”€â”€ migrations/ (NEW)
â”‚   â”‚   â”œâ”€â”€ index.js (existing)
â”‚   â”‚   â””â”€â”€ spellCheckMenu.js (existing)
â”‚   â””â”€â”€ renderer/
â”‚       â”œâ”€â”€ tabs/ (NEW)
â”‚       â”‚   â”œâ”€â”€ index.html
â”‚       â”‚   â”œâ”€â”€ index.js
â”‚       â”‚   â””â”€â”€ preload.js
â”‚       â”œâ”€â”€ preload.js (existing)
â”‚       â””â”€â”€ index.html (existing)
```

### Key Dependencies to Add
```json
{
  "@atlaskit/pragmatic-drag-and-drop": "1.4.0",
  "@atlaskit/pragmatic-drag-and-drop-hitbox": "1.0.3"
}
```

---

## What We're NOT Implementing

- âŒ Audio/microphone monitoring
- âŒ Speaker status detection
- âŒ AI/transcription features (server-side only)
- âŒ Video call interception
- âŒ Analytics/telemetry
- âŒ Crash reporting to external services

---

## Success Criteria

### Offline Mode
- [ ] App works without internet connection
- [ ] Previously visited pages load from cache
- [ ] Graceful sync when back online
- [ ] Clear offline/online indicators

### Tab Management
- [ ] Create/close tabs easily
- [ ] Switch between tabs with keyboard shortcuts
- [ ] Tabs persist across app restarts
- [ ] Tab titles and favicons update correctly
- [ ] Pin important tabs

### Breadcrumbs
- [ ] Current location shown in each tab
- [ ] Breadcrumbs update as you navigate
- [ ] Proper styling and truncation
- [ ] Click to navigate (optional enhancement)

---

## Questions to Answer Before Starting

1. **Offline Mode:**
   - What data should we cache? (Pages only? Blocks? Images?)
   - How much disk space should cache use?
   - When should we invalidate cache?

2. **Tabs:**
   - Should we support multiple windows initially, or single window first?
   - How many tabs should we allow?
   - Should tab state persist across restarts?

3. **Breadcrumbs:**
   - Should breadcrumbs be clickable for navigation?
   - How do we handle very long breadcrumb paths?

---

## Next Steps

1. **Review this roadmap** - Confirm priorities and scope
2. **Set up development environment** - Ensure all tools ready
3. **Create feature branches** - One per major feature
4. **Start with Sprint 1** - Tab management foundation

---

**Target Release:** 8-10 weeks from start
**Current Version:** 1.0.0
**Next Version:** 1.5.0
