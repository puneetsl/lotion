# Lotion v1.5 - Development Roadmap

**Status:** âœ… COMPLETED (October 27, 2025)

## What Was Actually Implemented

Lotion v1.5 successfully implemented a complete multi-tab system with modern frameless window design. Instead of following the original three-feature roadmap (Offline Mode, Tab Management, Breadcrumbs), we focused entirely on perfecting the tab management experience with a clean, modern UI.

### Completed Features âœ…

1. **Frameless Window Design**
   - Custom 32px title bar
   - Seamless integration with tab bar
   - Window control buttons (minimize, maximize, close)
   - Fixed maximize/resize behavior

2. **Multi-Tab System**
   - Create/close tabs
   - Switch between tabs
   - Tab reordering
   - Favicon support with fallback
   - Active tab highlighting
   - Tab title updates

3. **Navigation Controls**
   - Back button (â€¹)
   - Forward button (â€º)
   - Refresh button (â†»)
   - Integrated into tab bar

4. **Logo Menu**
   - Clickable Lotion logo
   - Native popup menu
   - GitHub project links
   - Opens links in default browser

5. **Context Menu & Spell Check**
   - Right-click context menu
   - Spell check suggestions (English US)
   - Add to dictionary
   - Standard editing commands
   - Link and image handling
   - Inspect Element (dev mode)

6. **Dark Mode**
   - CSS variable-based theming
   - Automatic theme detection
   - Consistent styling

7. **Redux State Management**
   - Complete tab state management
   - Window-tab relationships
   - Tab spaces/groups foundation (UI not yet built)

### Key Architecture Decisions

- **Vanilla JavaScript** instead of React for tab bar (better performance)
- **WebContentsView** for efficient tab rendering
- **Native Electron menus** for logo menu (avoids overflow issues)
- **Frameless window** with custom chrome for modern appearance

---

## Core Focus Areas (Original Plan vs. Reality)

### Original Plan

Based on analysis of the official Notion desktop app, v1.5 was originally planned to focus on three major features:

### 1. **Offline Mode with SQLite** ğŸ—„ï¸
**Priority:** HIGH
**Status:** Foundation exists (better-sqlite3 already installed)

#### What the Official App Does:
- Uses **better-sqlite3** (v11.8.1) for local database
- Separate `SqliteServer.js` module for database operations
- Built-in **SQLite browser** renderer for debugging
- Caches Notion pages locally for offline access
- Faster page loads with local cache

#### Implementation Plan:
- [ ] Create SQLite database schema for caching pages
- [ ] Implement SqliteServer module (separate from main process)
- [ ] Add data synchronization logic
- [ ] Cache page content, blocks, and metadata
- [ ] Handle offline/online state transitions
- [ ] Add cache invalidation strategy
- [ ] Optional: Build SQLite browser tool for debugging

#### Benefits:
- âœ… Works offline
- âœ… Faster page loads
- âœ… Reduced network usage
- âœ… Better user experience

---

### 2. **Tab Management System** ğŸ“‘
**Priority:** HIGH
**Status:** âœ… COMPLETED (with modifications)

#### What the Official App Does:
- **Multi-tab interface** like a web browser
- **Tab groups/spaces** - Organize tabs into sections
- **Tab pinning** with URL restoration
- **Drag-and-drop** tab reordering
- **Parent-child tab relationships**
- **Tab reparenting** - Move tabs between windows
- **Tab preview images** for placeholders
- **Close confirmation** for unsaved changes
- **Tab state persistence** across app restarts

#### Implementation Plan:

**Phase 1: Basic Tabs**
- [ ] Create tab bar UI component (separate renderer)
- [ ] Implement tab state in Redux
  - Tab ID, title, URL, favicon
  - Active tab per window
  - Tab order
- [ ] Add tab creation/closing logic
- [ ] Keyboard shortcuts (Ctrl+T, Ctrl+W, Ctrl+Tab)
- [ ] Tab switching UI and logic

**Phase 2: Advanced Features**
- [ ] Tab pinning functionality
- [ ] Tab groups/spaces
- [ ] Drag-and-drop reordering (using @atlaskit/pragmatic-drag-and-drop)
- [ ] Parent-child tab relationships
- [ ] Tab context menu (right-click)
- [ ] Close other tabs, close tabs to right/left

**Phase 3: Multi-Window**
- [ ] Tab reparenting between windows
- [ ] Tab placeholder previews
- [ ] Move tab to new window

#### Current Dependencies Needed:
```json
{
  "@atlaskit/pragmatic-drag-and-drop": "1.4.0",
  "@atlaskit/pragmatic-drag-and-drop-hitbox": "1.0.3"
}
```

#### Benefits:
- âœ… Multi-page workflow support
- âœ… Better organization
- âœ… Browser-like experience
- âœ… Productivity boost

---

### 3. **Enhanced Breadcrumbs** ğŸ
**Priority:** MEDIUM-HIGH
**Status:** Easiest to implement

#### What the Official App Does:
- Tracks **navigation hierarchy** per tab
- Stores breadcrumbs in Redux state
- Format: `Home > Workspace > Page > Subpage`
- Updates automatically as you navigate
- Displayed in tab UI (shows current location)

#### Implementation Plan:
- [ ] Add `breadcrumbs` field to tab state in Redux
- [ ] Listen for breadcrumb updates from Notion web app
- [ ] Create IPC channel for breadcrumb data
- [ ] Display breadcrumbs in tab bar UI
- [ ] Style breadcrumbs component
- [ ] Handle breadcrumb truncation for long paths

#### Redux State Addition:
```javascript
// In tabSlice.js
updateTabBreadcrumbs(state, action) {
  state[action.payload.tabId].breadcrumbs = action.payload.breadcrumbs;
}
```

#### Benefits:
- âœ… Know where you are in Notion hierarchy
- âœ… Quick visual reference
- âœ… Better navigation UX
- âœ… Matches official app behavior

---

## Implementation Order

### Sprint 1: Foundation (Weeks 1-2)
1. **Set up Tab Management Architecture**
   - Redux slices for tabs and windows
   - Tab bar renderer component
   - Basic IPC communication

2. **Implement Basic Tabs**
   - Create/close tabs
   - Switch between tabs
   - Tab title and favicon

### Sprint 2: Breadcrumbs (Week 3)
1. **Add Breadcrumb Support**
   - Redux state for breadcrumbs
   - IPC channel for breadcrumb updates
   - Display in tab bar

### Sprint 3: Offline Mode Foundation (Weeks 4-5)
1. **SQLite Integration**
   - Database schema design
   - SqliteServer module
   - Basic caching logic

2. **Offline Detection**
   - Online/offline state management
   - Sync strategy

### Sprint 4: Advanced Tabs (Weeks 6-7)
1. **Tab Pinning**
2. **Tab Groups**
3. **Drag-and-drop reordering**
4. **Context menus**

### Sprint 5: Polish & Testing (Week 8)
1. **Performance optimization**
2. **Bug fixes**
3. **Documentation**
4. **Testing**

---

## Technical Architecture Changes

### New Directory Structure
```
lotion/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ AppController.js (existing)
â”‚   â”‚   â”‚   â”œâ”€â”€ WindowController.js (existing)
â”‚   â”‚   â”‚   â””â”€â”€ TabController.js (NEW)
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”‚   â”œâ”€â”€ slices/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ appSlice.js (existing)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ windowsSlice.js (existing)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tabsSlice.js (NEW)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ tabSpacesSlice.js (NEW)
â”‚   â”‚   â”‚   â””â”€â”€ store.js (existing)
â”‚   â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”‚   â”œâ”€â”€ SqliteServer.js (NEW)
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.js (NEW)
â”‚   â”‚   â”‚   â””â”€â”€ migrations/ (NEW)
â”‚   â”‚   â”œâ”€â”€ index.js (existing)
â”‚   â”‚   â””â”€â”€ spellCheckMenu.js (existing)
â”‚   â””â”€â”€ renderer/
â”‚       â”œâ”€â”€ tabs/ (NEW)
â”‚       â”‚   â”œâ”€â”€ index.html
â”‚       â”‚   â”œâ”€â”€ index.js
â”‚       â”‚   â””â”€â”€ preload.js
â”‚       â”œâ”€â”€ preload.js (existing)
â”‚       â””â”€â”€ index.html (existing)
```

### Key Dependencies to Add
```json
{
  "@atlaskit/pragmatic-drag-and-drop": "1.4.0",
  "@atlaskit/pragmatic-drag-and-drop-hitbox": "1.0.3"
}
```

---

## What We're NOT Implementing

- âŒ Audio/microphone monitoring
- âŒ Speaker status detection
- âŒ AI/transcription features (server-side only)
- âŒ Video call interception
- âŒ Analytics/telemetry
- âŒ Crash reporting to external services

---

## Success Criteria

### Offline Mode
- [ ] App works without internet connection
- [ ] Previously visited pages load from cache
- [ ] Graceful sync when back online
- [ ] Clear offline/online indicators

### Tab Management
- [ ] Create/close tabs easily
- [ ] Switch between tabs with keyboard shortcuts
- [ ] Tabs persist across app restarts
- [ ] Tab titles and favicons update correctly
- [ ] Pin important tabs

### Breadcrumbs
- [ ] Current location shown in each tab
- [ ] Breadcrumbs update as you navigate
- [ ] Proper styling and truncation
- [ ] Click to navigate (optional enhancement)

---

## Questions to Answer Before Starting

1. **Offline Mode:**
   - What data should we cache? (Pages only? Blocks? Images?)
   - How much disk space should cache use?
   - When should we invalidate cache?

2. **Tabs:**
   - Should we support multiple windows initially, or single window first?
   - How many tabs should we allow?
   - Should tab state persist across restarts?

3. **Breadcrumbs:**
   - Should breadcrumbs be clickable for navigation?
   - How do we handle very long breadcrumb paths?

---

## Next Steps

1. **Review this roadmap** - Confirm priorities and scope
2. **Set up development environment** - Ensure all tools ready
3. **Create feature branches** - One per major feature
4. **Start with Sprint 1** - Tab management foundation

---

**Target Release:** 8-10 weeks from start
**Current Version:** 1.0.0
**Released Version:** 1.5.0 âœ…

---

## What's Next: v1.6+ Roadmap

### Features NOT Yet Implemented

Based on the original roadmap, these features could be added in future versions:

#### For v1.6:
- [ ] **Tab Pinning** - Pin important tabs
- [ ] **Tab Groups/Spaces** - Organize tabs into sections (Redux ready, UI needed)
- [ ] **Tab Persistence** - Save tabs across app restarts
- [ ] **Drag-and-drop Tab Reordering** - Visual tab reordering

#### For v1.7:
- [ ] **System Tray Integration** - Minimize to tray
- [ ] **Application Menu Bar** - Traditional menu bar
- [ ] **Keyboard Shortcuts** - Global shortcuts for navigation

#### For v2.0:
- [ ] **Offline Mode with SQLite** - Cache pages for offline access
- [ ] **Enhanced Breadcrumbs** - Clickable navigation hierarchy
- [ ] **Tab Reparenting** - Move tabs between windows
- [ ] **Multi-Window Support** - Multiple application windows

### Current Status Summary

âœ… **Completed in v1.5:**
- Frameless window design
- Multi-tab system with WebContentsView
- Navigation controls (back, forward, refresh)
- Logo menu with GitHub links
- Context menu with spell check
- Dark mode support
- Redux state management foundation

âŒ **Deferred to Future Versions:**
- Offline mode (requires significant backend work)
- Tab spaces/groups (state ready, UI not built)
- Tab pinning
- Tab persistence
- System tray
- Menu bar

**Development Time:** Completed in ~3 days (October 25-27, 2025)
**Lines of Code:** ~1,500 lines of new code
**Files Modified:** ~15 files
**Architecture:** Clean, maintainable, extensible
