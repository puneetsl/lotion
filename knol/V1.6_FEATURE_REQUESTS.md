# Lotion v1.6 - Feature Requests

**Created:** October 27, 2025
**Status:** Planning Phase

## High Priority Features (User Requested)

---

### 0. Notion-Enhancer Style Features (NEW!)

**Priority:** High
**Complexity:** Low to Medium
**Estimated Time:** 2-12 hours (depending on scope)

#### Description
Integrate notion-enhancer-style features including CSS theme injection, custom tweaks, and visual customizations. This was inspired by the popular (now defunct) notion-enhancer project.

#### What Notion-Enhancer Offered
- **Themes** - Custom color schemes (Dracula, Nord, Gruvbox, etc.)
- **CSS Tweaks** - Layout improvements, element hiding, padding adjustments
- **Mods** - JavaScript-based feature additions
- **Custom Inserts** - User-uploaded CSS/JS files

#### Implementation Phases

**Phase 1: Basic CSS Injection (v1.6) - 2-3 hours**
- Add CSS file loader to TabController
- Create `~/.config/Lotion/custom.css` for user CSS
- Add "Reload Custom CSS" to logo menu
- Document Notion CSS variables

**Phase 2: Built-in Tweaks Library (v1.6) - 4-6 hours**
- Port popular notion-enhancer tweaks
- Add tweak toggle UI to logo menu
- Store enabled tweaks in settings

Popular tweaks to implement:
- Hide '+ new' buttons
- Decrease side padding
- Smaller page icons
- Hide "Type '/' for commands"
- Center-aligned table headers
- Sticky table headers
- Hide backlinks/discussions

**Phase 3: Theme System (v1.7) - 8-12 hours**
- Create theme manager class
- Ship with 3-5 built-in themes (Dracula, Nord, Gruvbox)
- Theme selection UI
- Support user-created themes

#### Technical Implementation

**CSS Injection:**
```javascript
// In TabController.js
async injectCustomCSS() {
  const customCSSPath = path.join(app.getPath('userData'), 'custom.css');
  if (fs.existsSync(customCSSPath)) {
    const css = fs.readFileSync(customCSSPath, 'utf8');
    const key = await this.webContentsView.webContents.insertCSS(css);
    this.injectedCSSKey = key;
  }
}
```

**User Benefits:**
- Personalize Notion appearance
- Hide distracting elements
- Improve layout and spacing
- Use community-created themes
- Migration path for notion-enhancer users

**Detailed Documentation:** See `NOTION_ENHANCER_INTEGRATION.md` for complete implementation guide.

---

### 1. Spell Checker Toggle

**Priority:** High
**Complexity:** Low
**Estimated Time:** 2-3 hours

#### Description
Add ability to enable/disable spell checker through the logo menu.

#### Implementation Details
- Add "Toggle Spell Check" option to logo menu
- Store preference in Redux settings slice or electron-store
- Add IPC handler to enable/disable spell checker
- Use `webContents.session.setSpellCheckerEnabled(enabled)`
- Show checkmark next to menu item when enabled

#### Files to Modify
- `src/main/index.js` - Add spell check toggle IPC handler
- `src/main/store/slices/settingsSlice.js` - Add spellCheckEnabled state (if using Redux)
- `src/main/controllers/TabController.js` - Apply spell check setting to new tabs

#### Technical Notes
```javascript
// In TabController.js
if (!settingsState.spellCheckEnabled) {
  this.webContentsView.webContents.session.setSpellCheckerEnabled(false);
}
```

---

### 2. Internal Navigation for Notion Links

**Priority:** High
**Complexity:** Medium
**Estimated Time:** 4-6 hours

#### Description
Keep all notion.so links (including logout, settings, etc.) within the app instead of opening in external browser.

#### Implementation Details
- Modify `will-navigate` event handler in TabController
- Check if URL is notion.so domain before preventing navigation
- Allow internal navigation for notion.so URLs
- Still open non-notion.so URLs in external browser

#### Current Code (TabController.js)
```javascript
// Block navigation to external sites
webContents.on('will-navigate', (event, navigationUrl) => {
  const parsedUrl = new URL(navigationUrl);
  if (parsedUrl.origin !== config.domainBaseUrl) {
    event.preventDefault();
    require('electron').shell.openExternal(navigationUrl);
  }
});
```

#### Proposed Solution
```javascript
// Allow navigation within Notion domain
webContents.on('will-navigate', (event, navigationUrl) => {
  const parsedUrl = new URL(navigationUrl);
  const notionDomains = ['https://www.notion.so', 'https://notion.so'];

  // Check if URL is a Notion domain
  const isNotionUrl = notionDomains.some(domain =>
    navigationUrl.startsWith(domain)
  );

  // Only block if it's NOT a Notion URL
  if (!isNotionUrl) {
    event.preventDefault();
    require('electron').shell.openExternal(navigationUrl);
  }
  // If it IS a Notion URL, allow navigation (don't prevent)
});
```

#### Files to Modify
- `src/main/controllers/TabController.js` - Update `will-navigate` handler
- `config/config.json` - Add `allowedDomains` array

#### Edge Cases to Handle
- Subdomains (e.g., `workspace.notion.so`)
- Redirect URLs that go through Notion
- OAuth flows
- File downloads

---

### 3. Notion Keyboard Shortcuts Support

**Priority:** High
**Complexity:** High
**Estimated Time:** 8-12 hours

#### Description
Support official Notion keyboard shortcuts like Ctrl+N for new note, and others.

#### Research Needed
- [ ] Document all official Notion desktop app shortcuts
- [ ] Test which shortcuts already work (passed through to web app)
- [ ] Identify which shortcuts need app-level implementation

#### Known Notion Shortcuts
- `Ctrl+N` - Create new page
- `Ctrl+Shift+N` - Open new Notion window
- `Ctrl+[` - Go back
- `Ctrl+]` - Go forward
- `Ctrl+P` - Search or jump to page
- `Ctrl+K` - Insert link
- `Ctrl+Shift+L` - Toggle dark mode
- `Ctrl+/` - Show keyboard shortcuts
- Many more...

#### Implementation Approach

**Option 1: Let Notion Handle It**
- Most shortcuts should work automatically since we're loading the full Notion web app
- Only implement shortcuts that affect the Electron wrapper (new window, etc.)

**Option 2: Global Shortcuts**
- Register global shortcuts at app level
- Forward to appropriate handler (new tab, new window, etc.)

#### Recommended Approach
Start with Option 1, then add app-level shortcuts for:
- `Ctrl+T` - New tab
- `Ctrl+W` - Close tab
- `Ctrl+Tab` / `Ctrl+Shift+Tab` - Switch between tabs
- `Ctrl+Shift+N` - New window (when multi-window support added)

#### Files to Modify
- `src/main/index.js` - Register global shortcuts
- `src/main/controllers/WindowController.js` - Handle window-level shortcuts
- Create `src/main/shortcuts.js` - Centralized shortcut management

#### Technical Notes
```javascript
// In main process
const { globalShortcut } = require('electron');

// Register shortcuts
globalShortcut.register('CommandOrControl+T', () => {
  // Create new tab in focused window
  const focusedWindow = appController.getFocusedWindowController();
  focusedWindow.createTab();
});
```

---

### 4. Use Notion's Native Top Bar

**Priority:** High
**Complexity:** Very High
**Estimated Time:** 16-24 hours

#### Description
Replace the custom 32px tab bar with Notion's native `.notion-topbar` element (44px), similar to macOS implementation. This would provide better space efficiency and native Notion look.

#### Current Architecture
- Custom tab bar: 32px WebContentsView with vanilla JS
- Tab management: External to Notion web app
- Navigation: Custom back/forward/refresh buttons
- Logo menu: Custom implementation

#### Proposed Architecture
- Use Notion's `.notion-topbar` as the tab bar
- Inject custom tabs into the top bar
- Maintain Notion's breadcrumbs and controls
- Add tab switching logic via JavaScript injection

#### Notion Top Bar Structure (from provided HTML)
```html
<header style="background: var(--c-bacPri); max-width: 100vw; z-index: 100;">
  <div class="notion-topbar" style="height: 44px;">
    <!-- Left: Breadcrumbs -->
    <div class="notranslate shadow-cursor-breadcrumb">
      <!-- Page icon and title -->
    </div>

    <!-- Right: Action buttons -->
    <div class="notion-topbar-action-buttons">
      <!-- Share, Favorite, More buttons -->
    </div>
  </div>
</header>
```

#### Implementation Challenges

1. **Tab Injection into Notion DOM**
   - Need to inject tab UI into Notion's `.notion-topbar`
   - Must respect Notion's styling and layout
   - Need to handle Notion's dynamic rendering

2. **CSS Conflicts**
   - Notion uses CSS variables (`var(--c-bacPri)`)
   - Need to match Notion's theme
   - Custom tab styles must blend in

3. **JavaScript Injection**
   - Use `webContents.executeJavaScript()` to inject tab UI
   - Monitor DOM changes with MutationObserver
   - Handle Notion's client-side routing

4. **Window Controls**
   - Still need minimize/maximize/close buttons
   - Could place them in Notion's top bar
   - Or keep separate 10px title bar for window controls only

#### Proposed Solution Options

**Option A: Hybrid Approach (Recommended)**
- Keep very thin (10-12px) title bar for window controls only
- Let Notion's top bar handle breadcrumbs and actions
- Add custom tab list below or beside breadcrumbs
- Total height: ~54-56px (10px controls + 44px Notion bar)

**Option B: Full Integration**
- Inject tabs directly into Notion's `.notion-topbar`
- Add window controls to right side of Notion bar
- Total height: 44px (Notion's default)
- Higher complexity, more risk of breaking on Notion updates

**Option C: macOS Style**
- Hide Notion's top bar completely
- Create custom bar that mimics Notion's styling
- Include tabs, breadcrumbs, and controls
- Total height: 44px
- Most control, but duplicates Notion's UI

#### Recommended Implementation: Option A

**Step 1: Reduce Window Controls Bar**
```javascript
// In WindowController.js
this.WINDOW_CONTROLS_HEIGHT = 12; // Reduced from 32
this.NOTION_TOPBAR_HEIGHT = 44;   // Notion's standard height
```

**Step 2: Inject Tab Switcher into Notion**
```javascript
// Inject after Notion loads
webContents.executeJavaScript(`
  (function() {
    const topbar = document.querySelector('.notion-topbar');
    if (!topbar) return;

    // Create tab container
    const tabContainer = document.createElement('div');
    tabContainer.id = 'lotion-tabs';
    tabContainer.style.cssText = \`
      display: flex;
      gap: 4px;
      margin-left: 12px;
      height: 100%;
      align-items: center;
    \`;

    // Insert after breadcrumbs
    const breadcrumbs = topbar.querySelector('.shadow-cursor-breadcrumb');
    breadcrumbs.parentNode.insertBefore(tabContainer, breadcrumbs.nextSibling);
  })();
`);
```

**Step 3: Tab Communication**
- Use IPC to sync tab state between main process and injected UI
- Send tab list updates to injected UI
- Receive tab switch events from injected UI

#### Files to Create/Modify
- `src/main/controllers/WindowController.js` - Reduce controls bar height
- `src/main/controllers/TabController.js` - Add tab injection logic
- `src/renderer/tab-injector/` - New directory for injection scripts
- `src/renderer/tab-injector/inject.js` - Tab UI injection script
- `src/renderer/tab-injector/styles.css` - Tab styles matching Notion theme

#### Technical Risks
- **Notion Updates** - Notion UI changes could break injection
- **Performance** - DOM injection on every page load
- **Theme Compatibility** - Must work with light and dark modes
- **Client-Side Routing** - Must survive Notion's SPA navigation

#### Rollback Plan
If this approach proves too fragile:
- Keep current custom tab bar
- Make it more compact (reduce to 24-28px)
- Add option to toggle between custom bar and native bar

---

## Implementation Priority Order

Based on complexity and user impact:

1. **Spell Checker Toggle** (Quick win, 2-3 hours)
2. **Internal Navigation for Notion Links** (Medium effort, high impact, 4-6 hours)
3. **Notion Keyboard Shortcuts** (High impact, 8-12 hours)
4. **Use Notion's Native Top Bar** (Complex, requires careful planning, 16-24+ hours)

**Total Estimated Time for v1.6:** 30-45 hours of development

---

## Questions for User

1. **Top Bar Implementation:**
   - Do you prefer Option A (hybrid with thin controls bar) or Option B (full integration)?
   - Are you okay with potential breakage if Notion updates their UI?
   - Should we add a toggle to switch between custom and native bar?

2. **Keyboard Shortcuts:**
   - Which shortcuts are most important to you?
   - Should we document and test all official Notion shortcuts first?
   - Do you want custom shortcuts that differ from official Notion?

3. **Spell Checker:**
   - Should this be a global setting or per-tab?
   - Should we remember the setting across app restarts?

---

## Next Steps

1. Get user feedback on top bar implementation approach
2. Research and document all Notion keyboard shortcuts
3. Create prototype for each feature
4. Test thoroughly before merging to main branch
5. Update user documentation

---

**Last Updated:** October 27, 2025
**Next Review:** After user feedback
